(()=>{"use strict";var e,t,n,r;!function(e){e.Get="GET",e.Post="POST",e.Delete="DELETE",e.Put="PUT",e.Patch="PATCH"}(e||(e={})),function(e){e.Started="started",e.Stopped="stopped",e.Drive="drive"}(t||(t={})),function(e){e.Id="id",e.Wins="wins",e.Time="time"}(n||(n={})),function(e){e.Asc="ASC",e.Desc="DESC"}(r||(r={}));const a={cars:[],countCars:0,countWinners:0,carsRaceTime:{},carsRace:{},carsHTML:{},editorCar:{carEditId:-1,formInputCreate:null,formInputEdit:null,inputColorCreate:null,inputColorEdit:null,btnEditorUpdate:null,btnEditorCreate:null,btnStartRace:null,btnResetRace:null,btnGaragePrevPage:null,btnGarageNextPage:null},controls:{},renderPosition:{},inGame:!1,currentGaragePage:1,pagesCountGarage:0,carsPerPage:7,currentWinnersPage:1,winnerPerPage:10,pagesCountWinner:0,sortWinners:n.Wins,SortOrderWinners:r.Desc,winnersTable:[],carsBrands:["Chrysler","Dodge","Jeep","Ram","Ford","Lincoln","Cadillac","Chevrolet","Tesla","Audi","BMW","Daimler","Lotec","Mercedes","Vauxhall","Volkswagen","AZLK","Lada","Moskvitch","Volga"],carsModels:["A3","Sandero","2106","RS","e-tron","TTS","Golf","Bulldog","Pagoda","DB7","LeMans","Aspen","Cordoba","Crossfire","Concorde","Stratus","Viper"]},o=e=>{const t=document.createElement("template");if(t.innerHTML=e,!t.content.firstElementChild)throw new Error("Can't create element");return t.content.firstElementChild};var i;!function(e){e.BtnStartOne="BtnStartOne",e.BtnRemoveOne="BtnRemoveOne",e.BtnResetOne="BtnResetOne",e.BtnSelectOne="BtnSelectOne",e.BtnCreateCar="BtnCreateCar",e.BtnUpdateEdit="BtnUpdateEdit",e.BtnAdd100Cars="BtnAdd100Cars",e.BtnStartRace="BtnStartRace",e.BtnResetRace="BtnResetRace",e.BtnGaragePrevPage="BtnGaragePrevPage",e.BtnGarageNextPage="BtnGarageNextPage",e.BtnWinnerPrevPage="BtnWinnerPrevPage",e.BtnWinnerNextPage="BtnWinnerNextPage"}(i||(i={}));const s=(e,t)=>{const{btnType:n,handler:r,carId:a}=t,o=document.createElement("button");return o.innerText=e,o.classList.add("btn"),o.dataset.btnType=n,"function"==typeof r&&o.addEventListener("click",r),a&&(o.dataset.carId=a.toString()),o},c=async(t,n)=>{const{body:r,...a}=n;if("object"!=typeof r&&void 0!==r)throw new Error("Body must be an object {name: string; color: string;} or undefined");const o={method:r?e.Post:e.Get,...a,headers:{"Content-type":"application/json"}};"object"==typeof a.headers&&Object.assign(o.headers,a.headers),r&&(o.body=JSON.stringify(r));try{const e=await fetch(t,o);if(!e.ok)throw new Error(e.status.toString());return e}catch(e){return e instanceof Error?Promise.reject(e):Promise.reject(new Error("Cant resolve promise"))}};c.get=async function(e,t={}){return await c(e,t)},c.post=function(e,t,n={}){return c(e,{body:t,...n})},c.delete=function(t,n={}){return c(t,{method:e.Delete,...n})},c.put=function(t,n,r={}){return c(t,{body:n,method:e.Put,...r})},c.patch=function(t,n,r={}){return c(t,{body:n,method:e.Patch,...r})};const d="http://127.0.0.1:3000",l=`${d}/garage`,u=`${d}/engine`,p=`${d}/winners`,m=async e=>{const t=`${l}/${e}`,n=await c.get(t);if(!n)throw new Error(`Can't get car with id=${e}`);return Object(n.json())},f=async e=>{const t=await c.post(l,e);let n={id:-1,name:"unknown",color:"unknown"};return"object"==typeof t&&(n=Object(t)),n},g=async e=>{const t=`${p}/${e}`;let n={id:-1,wins:0,time:0};try{const e=await c.get(t).then((e=>e.json()));n=Object(e)}catch(e){return n}return n},b=async()=>{const{winners:e,countWinners:t}=await(async(e,t,n,r)=>{const a=`${p}?_page=${e}&_limit=${t}&_sort=${n}&_order=${r}`,o={headers:{"X-Total-Count":t.toString()}};let i=[];const s=await c.get(a,o),d=s.headers.get("X-Total-Count");let l=0;const u=await s.json();return d&&(l=parseInt(d,10)),console.log(u),Array.isArray(u)&&(i=Array.from(u)),{countWinners:l,winners:i}})(a.currentWinnersPage,a.winnerPerPage,a.sortWinners,a.SortOrderWinners);a.countWinners=t,a.pagesCountWinner=Math.ceil(t/a.winnerPerPage);const n=e.map((e=>m(e.id))),r=await Promise.all(n);a.winnersTable=e.map((e=>Object.assign(e,r.filter((t=>t.id===e.id))[0])))},w=async()=>{const{cars:e,countCars:t}=await(async(e,t)=>{const n=`${l}?_page=${e}&_limit=${t}`,r={headers:{"X-Total-Count":t.toString()}};let a=[];const o=await c.get(n,r),i=o.headers.get("X-Total-Count");let s=0;i&&(s=parseInt(i,10));const d=await o.json();return Array.isArray(d)&&(a=Array.from(d)),{countCars:s,cars:a}})(a.currentGaragePage,a.carsPerPage);a.cars=e,a.countCars=t,a.pagesCountGarage=Math.ceil(t/a.carsPerPage),b(),(()=>{for(let e=0;e<a.cars.length;e+=1)a.carsRace[a.cars[e].id]=!1})(),(()=>{for(let e=0;e<a.cars.length;e+=1)a.controls[a.cars[e].id]={remove:null,reset:null,select:null,start:null}})()},h=(e,t)=>{const n=performance.now();let r=-1;void 0!==e.dataset.carId&&(r=parseInt(e.dataset.carId,10)),requestAnimationFrame((function o(i){const s=(i-n)/t;e.style.transform=`translate(${90*s}%)`,s<1&&a.carsRace[r]&&requestAnimationFrame(o)}))},y=e=>{a.controls[e].remove?.setAttribute("disabled","disabled"),a.controls[e].start?.setAttribute("disabled","disabled"),a.controls[e].select?.setAttribute("disabled","disabled")},E=e=>{a.controls[e].remove?.removeAttribute("disabled"),a.controls[e].start?.removeAttribute("disabled"),a.controls[e].select?.removeAttribute("disabled")},C=e=>{const t=o('<div class="infoAndNav"> <h2><span id="countRecordsTitle"></span>: <span id="countRecords"></span></h2> <h3>Page: <span id="currentPage"></span> (<span id="pages"></span>)</h3> <button data-btn-type="" id="btnPrevPage" class="btn">Prev page</button><button data-btn-type="" id="btnNextPage" class="btn">Next page</button> </div> '),{countTitleText:n,storeField:r,storeFieldCurrentPage:i,storeFieldPages:s,btnPrevPageType:c,btnNextPageType:d}=e,l=t.querySelector("#countRecordsTitle"),u=t.querySelector("#countRecords"),p=t.querySelector("#currentPage"),m=t.querySelector("#pages"),f=t.querySelector("#btnPrevPage"),g=t.querySelector("#btnNextPage");if(!(l instanceof HTMLSpanElement&&u instanceof HTMLSpanElement&&p instanceof HTMLSpanElement&&m instanceof HTMLSpanElement))throw new Error("Can't find span for info");if(!(f instanceof HTMLButtonElement&&g instanceof HTMLButtonElement))throw new Error("Can't find buttons for Nav");return f.dataset.btnType=c,g.dataset.btnType=d,l.innerText=n,u.innerText=a[r].toString(),p.innerText=a[i].toString(),m.innerText=a[s].toString(),t},v=e=>{const t=o('<section id="garage" class="garage"></section> '),n=(e=>{const t=o('<form id="editor_form" class="editor_form"> <div class="create_car"> <input type="text" class="input_text-editor" id="inputCreate" placeholder="Input car name"/><input type="color" class="input_color-editor" id="inputColorCreate"/><button class="btn" id="btnEditorCreate" data-btn-type="BtnCreateCar"> Create </button> </div> <div class="update_car"> <input type="text" class="input_text-editor" id="inputEdit" placeholder="Input car name" disabled="disabled"/><input type="color" class="input_color-editor" id="inputColorEdit" disabled="disabled"/><button class="btn" id="btnEditorUpdate" data-btn-type="BtnUpdateEdit" disabled="disabled"> Update </button> </div> <div class="control_race_bnts"> <button class="btn" id="btnGenerate100" data-btn-type="BtnAdd100Cars">Generate 100</button> <button class="btn" id="btnStartRace" data-btn-type="BtnStartRace">Start</button> <button class="btn" id="btnResetRace" data-btn-type="BtnResetRace" disabled="disabled">Reset</button> </div> </form> ');e&&e.length>0&&t.append(...e);const n=C({countTitleText:"Garage",storeField:"countCars",storeFieldCurrentPage:"currentGaragePage",storeFieldPages:"pagesCountGarage",btnPrevPageType:"BtnGaragePrevPage",btnNextPageType:"BtnGarageNextPage"});return t.append(n),(e=>{const t=e.querySelector("#inputCreate"),n=e.querySelector("#inputEdit"),r=e.querySelector("#inputColorCreate"),o=e.querySelector("#inputColorEdit"),i=e.querySelector("#btnEditorUpdate"),s=e.querySelector("#btnEditorCreate"),c=e.querySelector("#btnStartRace"),d=e.querySelector("#btnResetRace");if(!(t instanceof HTMLInputElement&&n instanceof HTMLInputElement))throw new Error("Can't find input for editor");if(!(r instanceof HTMLInputElement&&o instanceof HTMLInputElement))throw new Error("Can't find inputColor for editor");if(!(i instanceof HTMLButtonElement&&s instanceof HTMLButtonElement))throw new Error("Can't find Create or Update button for editor");if(!(c instanceof HTMLButtonElement&&d instanceof HTMLButtonElement))throw new Error("Can't find Start or Reset button for editor");a.editorCar.formInputCreate=t,a.editorCar.formInputEdit=n,a.editorCar.inputColorCreate=r,a.editorCar.inputColorEdit=o,a.editorCar.btnEditorUpdate=i,a.editorCar.btnEditorCreate=s,a.editorCar.btnStartRace=c,a.editorCar.btnResetRace=d})(t),t})(),r=a.cars.map((e=>((e,t)=>{const n=o('<div class="carline"> <div class="wrapper"> <div class="wrapper_controls"> <div class="carline_controls" id="carline_controls"></div> <div class="car_name" id="car_name"></div> </div> <div class="road"> <div class="ufo" id="ufo"> <svg version="1.0" xmlns="http://www.w3.org/2000/svg" width="48.000000pt" height="48.000000pt" viewBox="0 0 512.000000 512.000000" preserveAspectRatio="xMidYMid meet" class="car" id="car_img"> <g transform="translate(0.000000,512.000000) scale(0.100000,-0.100000)" stroke="none"> <path d="M2736 3959 c-387 -59 -699 -317 -822 -677 -19 -54 -38 -131 -45 -173\nl-11 -76 -137 -6 c-151 -6 -219 -22 -327 -73 -245 -116 -410 -358 -431 -634\nl-6 -80 -54 0 c-44 0 -58 -5 -78 -25 -30 -29 -32 -74 -6 -106 16 -20 31 -25\n92 -29 l72 -5 18 -52 c69 -204 243 -387 443 -463 39 -16 96 -33 127 -39 55\n-12 56 -12 85 -74 65 -139 229 -260 388 -288 102 -17 295 -7 375 20 129 44\n243 142 304 258 l32 63 205 0 205 0 33 -64 c68 -131 213 -240 359 -271 81 -17\n246 -19 329 -4 32 6 92 26 132 45 94 43 193 140 242 236 35 67 35 68 90 79\n277 57 514 282 587 559 24 89 23 291 -1 379 -55 201 -194 378 -376 479 -81 45\n-211 82 -320 90 l-95 7 -7 59 c-50 395 -356 736 -758 843 -87 24 -115 26 -340\n29 -135 1 -272 -1 -304 -7z m605 -177 c308 -83 542 -317 620 -620 10 -41 19\n-88 19 -104 l0 -28 -981 0 -980 0 7 48 c3 26 19 88 35 137 80 253 292 466 547\n550 115 37 189 44 427 41 193 -3 242 -7 306 -24z m-1378 -1356 c67 -27 115\n-115 102 -184 -16 -88 -84 -146 -170 -146 -148 0 -229 171 -132 281 53 60 129\n79 200 49z m1077 -6 c54 -27 83 -72 88 -137 5 -64 -9 -103 -54 -143 -45 -39\n-102 -54 -154 -40 -48 13 -103 59 -120 100 -18 44 -8 130 19 169 48 67 145 90\n221 51z m1053 6 c44 -18 95 -78 103 -121 20 -111 -60 -209 -171 -209 -149 0\n-225 169 -127 286 46 55 126 73 195 44z m-1523 -934 c0 -18 -72 -91 -118 -120\n-74 -48 -156 -65 -292 -60 -103 3 -122 7 -180 34 -61 29 -139 95 -161 136 -9\n17 6 18 371 18 209 0 380 -4 380 -8z m1531 -10 c-22 -41 -100 -107 -161 -136\n-58 -27 -77 -31 -180 -34 -136 -5 -218 12 -292 60 -46 29 -118 102 -118 120 0\n4 171 8 380 8 365 0 380 -1 371 -18z"/> <path d="M2985 3415 c-16 -15 -25 -36 -25 -55 0 -19 9 -40 25 -55 l24 -25 271\n0 271 0 24 25 c16 15 25 36 25 55 0 19 -9 40 -25 55 l-24 25 -271 0 -271 0\n-24 -25z"/> <path d="M985 3655 c-16 -15 -25 -36 -25 -55 0 -19 9 -40 25 -55 l24 -25 271\n0 271 0 24 25 c16 15 25 36 25 55 0 19 -9 40 -25 55 l-24 25 -271 0 -271 0\n-24 -25z"/> <path d="M185 2935 c-16 -15 -25 -36 -25 -55 0 -19 9 -40 25 -55 l24 -25 271\n0 271 0 24 25 c33 32 33 78 0 110 l-24 25 -271 0 -271 0 -24 -25z"/> <path d="M185 1335 c-16 -15 -25 -36 -25 -55 0 -19 9 -40 25 -55 l24 -25 271\n0 271 0 24 25 c33 32 33 78 0 110 l-24 25 -271 0 -271 0 -24 -25z"/> </g> </svg> </div> <div class="finish_flag"></div> </div> </div> </div> '),r=n.querySelector("#car_img"),c=n.querySelector("#car_name"),d=n.querySelector("#carline_controls"),l=n.querySelector("#ufo");if(!(r instanceof SVGElement))throw new Error("can't find SVG picture");if(!(c instanceof HTMLDivElement))throw new Error("can't find DIV element for carname");if(!(d instanceof HTMLDivElement))throw new Error("can't find DIV element for car controls");if(!(l instanceof HTMLDivElement))throw new Error("can't find DIV element for ufo");var u;return l.setAttribute("id",`ufo-${e.id}`),l.dataset.carId=e.id.toString(),a.carsHTML[e.id]=l,d.append(...(u=e.id,a.controls[u].select=s("Select",{btnType:i.BtnSelectOne,carId:u}),a.controls[u].remove=s("Remove",{btnType:i.BtnRemoveOne,carId:u}),a.controls[u].start=s("Start",{btnType:i.BtnStartOne,carId:u}),a.controls[u].reset=s("Reset",{btnType:i.BtnResetOne,carId:u}),[a.controls[u].select,a.controls[u].remove,a.controls[u].start,a.controls[u].reset])),r.setAttribute("fill",e.color),c.innerText=e.name,t&&t.length>0&&n.append(...t),n})(e)));return t.append(n,...r),e&&e.length>0&&t.prepend(...e),t},T=e=>{e.preventDefault();const t=document.querySelector("#app");if(!(t instanceof HTMLElement))throw new Error("Err");t.innerHTML="";const n=v();t.append(n)},P=()=>{const e=o('<section id="winners" class="winners"></section> '),t=(e=>{const t=o('<table class="winners_table"> <thead class="thead"> <th>#</th> <th>Car Image</th> <th>Name</th> <th>Wins</th> <th>Best time</th> </thead> <tbody id="table_winners_body"></tbody> </table> ');if(!(t.querySelector("#table_winners_body")instanceof HTMLElement))throw new Error("Can't find tBody for winners");const n=a.winnersTable.map(((e,t)=>((e,t)=>{const n=document.createElement("tr"),r=document.createElement("td"),a=document.createElement("td"),o=document.createElement("td"),i=document.createElement("td"),s=document.createElement("td"),c=document.createElementNS("http://www.w3.org/2000/svg","svg");return c.innerHTML='<g transform="translate(0.000000,512.000000) scale(0.100000,-0.100000)" stroke="none">\n<path d="M2736 3959 c-387 -59 -699 -317 -822 -677 -19 -54 -38 -131 -45 -173\nl-11 -76 -137 -6 c-151 -6 -219 -22 -327 -73 -245 -116 -410 -358 -431 -634\nl-6 -80 -54 0 c-44 0 -58 -5 -78 -25 -30 -29 -32 -74 -6 -106 16 -20 31 -25\n92 -29 l72 -5 18 -52 c69 -204 243 -387 443 -463 39 -16 96 -33 127 -39 55\n-12 56 -12 85 -74 65 -139 229 -260 388 -288 102 -17 295 -7 375 20 129 44\n243 142 304 258 l32 63 205 0 205 0 33 -64 c68 -131 213 -240 359 -271 81 -17\n246 -19 329 -4 32 6 92 26 132 45 94 43 193 140 242 236 35 67 35 68 90 79\n277 57 514 282 587 559 24 89 23 291 -1 379 -55 201 -194 378 -376 479 -81 45\n-211 82 -320 90 l-95 7 -7 59 c-50 395 -356 736 -758 843 -87 24 -115 26 -340\n29 -135 1 -272 -1 -304 -7z m605 -177 c308 -83 542 -317 620 -620 10 -41 19\n-88 19 -104 l0 -28 -981 0 -980 0 7 48 c3 26 19 88 35 137 80 253 292 466 547\n550 115 37 189 44 427 41 193 -3 242 -7 306 -24z m-1378 -1356 c67 -27 115\n-115 102 -184 -16 -88 -84 -146 -170 -146 -148 0 -229 171 -132 281 53 60 129\n79 200 49z m1077 -6 c54 -27 83 -72 88 -137 5 -64 -9 -103 -54 -143 -45 -39\n-102 -54 -154 -40 -48 13 -103 59 -120 100 -18 44 -8 130 19 169 48 67 145 90\n221 51z m1053 6 c44 -18 95 -78 103 -121 20 -111 -60 -209 -171 -209 -149 0\n-225 169 -127 286 46 55 126 73 195 44z m-1523 -934 c0 -18 -72 -91 -118 -120\n-74 -48 -156 -65 -292 -60 -103 3 -122 7 -180 34 -61 29 -139 95 -161 136 -9\n17 6 18 371 18 209 0 380 -4 380 -8z m1531 -10 c-22 -41 -100 -107 -161 -136\n-58 -27 -77 -31 -180 -34 -136 -5 -218 12 -292 60 -46 29 -118 102 -118 120 0\n4 171 8 380 8 365 0 380 -1 371 -18z"/>\n<path d="M2985 3415 c-16 -15 -25 -36 -25 -55 0 -19 9 -40 25 -55 l24 -25 271\n0 271 0 24 25 c16 15 25 36 25 55 0 19 -9 40 -25 55 l-24 25 -271 0 -271 0\n-24 -25z"/>\n<path d="M985 3655 c-16 -15 -25 -36 -25 -55 0 -19 9 -40 25 -55 l24 -25 271\n0 271 0 24 25 c16 15 25 36 25 55 0 19 -9 40 -25 55 l-24 25 -271 0 -271 0\n-24 -25z"/>\n<path d="M185 2935 c-16 -15 -25 -36 -25 -55 0 -19 9 -40 25 -55 l24 -25 271\n0 271 0 24 25 c33 32 33 78 0 110 l-24 25 -271 0 -271 0 -24 -25z"/>\n<path d="M185 1335 c-16 -15 -25 -36 -25 -55 0 -19 9 -40 25 -55 l24 -25 271\n0 271 0 24 25 c33 32 33 78 0 110 l-24 25 -271 0 -271 0 -24 -25z"/>\n</g>\n',c.setAttribute("fill",e.color.toString()),c.setAttribute("width","32px"),c.setAttribute("height","32px"),c.setAttribute("viewBox","0 0 512.000000 512.000000"),r.innerText=t.toString(),a.append(c),o.innerText=e.name,i.innerText=e.wins.toString(),s.innerText=e.time.toString(),n.append(r,a,o,i,s),n})(e,t+1+10*(a.currentWinnersPage-1))));return t.append(...n),e&&e.length>0&&t.append(...e),t})(),n=C({countTitleText:"Winners",storeField:"countWinners",storeFieldCurrentPage:"currentWinnersPage",storeFieldPages:"pagesCountWinner",btnPrevPageType:"BtnWinnerPrevPage",btnNextPageType:"BtnWinnerNextPage"});return e.append(n,t),e},S=e=>{e.preventDefault();const t=document.querySelector("#app");if(!(t instanceof HTMLElement))throw new Error("Err");t.innerHTML="";const n=P();t.append(n)},M=(e,t)=>Math.floor(Math.random()*(t-e+1)+e),B=e=>M(0,e),L=()=>{const e=["#"];for(let t=0;t<6;t+=1)e.push(M(0,14).toString(16));return e.join("")},R=async(e,t)=>{const n=`${u}?id=${e}&status=${t}`,r={id:e.toString(),status:t};try{return await c.patch(n,r).then((e=>e.json()))}catch(t){if(t instanceof Error)return"500"===t.message&&(a.carsRace[e]=!1),Promise.reject()}return e},H=e=>R(e,t.Started),I=e=>R(e,t.Stopped),x=n=>{const{target:r}=n;if(r instanceof HTMLButtonElement){const{btnType:o}=r.dataset;switch(console.log(o),o){case i.BtnStartOne:(async e=>{const{target:t}=e;if(!(t instanceof HTMLButtonElement))throw new Error("Can't find button element Start");const n=document.querySelector(`#ufo-${t.dataset.carId}`);if(!(n instanceof HTMLElement))throw new Error("err");const{carId:r}=t.dataset;if(r){const e=parseInt(r,10);y(e);const t=await H(e);a.carsRace[e]=!0,a.carsRaceTime[e]=t.distance/t.velocity,h(n,a.carsRaceTime[e])}})(n);break;case i.BtnResetOne:(async e=>{const{target:t}=e;if(!(t instanceof HTMLButtonElement))throw new Error("Can't find button element Start");const{carId:n}=t.dataset;if(n){const e=parseInt(n,10);await I(e),a.carsRace[e]=!1,setTimeout((()=>{a.carsHTML[e].style.transform="translate(0)"}),50),E(e)}console.log("StopOneCar click")})(n);break;case i.BtnRemoveOne:(async t=>{const{target:n}=t;if(!(n instanceof HTMLButtonElement))throw new Error("Can't find button element Remove");const{carId:r}=n.dataset;if(r){const t=parseInt(r,10);await(async t=>{const n=`${l}/${t}`,r={method:e.Delete};await m(t)&&await c.delete(n,r)})(t),-1!==(await g(t)).id&&(await(async t=>{const n=`${p}/${t}`,r={method:e.Delete};(await g(t)).id&&await c.delete(n,r)})(parseInt(r,10)),b())}await w(),console.log(a);const o=document.querySelector("#app");if(!(o instanceof HTMLElement))throw new Error("Can't find button element Main app");o.innerHTML="",o.append(v())})(n);break;case i.BtnSelectOne:(e=>{const{target:t}=e;if(!(t instanceof HTMLButtonElement))throw new Error("Can't find button element Select");const{carId:n}=t.dataset;if(n){const e=parseInt(n,10),t=a.cars.filter((t=>t.id===e))[0];a.editorCar.carEditId=e,a.editorCar.formInputEdit?.removeAttribute("disabled");const{formInputEdit:r}=a.editorCar,{inputColorEdit:o}=a.editorCar;if(!(r instanceof HTMLInputElement&&o instanceof HTMLInputElement))throw new Error("Can't load form editor");r.value=t.name,o.value=t.color,a.editorCar.inputColorEdit?.removeAttribute("disabled"),a.editorCar.btnEditorUpdate?.removeAttribute("disabled")}})(n);break;case i.BtnAdd100Cars:(async e=>{e.preventDefault(),await(async e=>{const t=[];for(let e=0;e<100;e+=1){const e=a.carsBrands[B(a.carsBrands.length-1)],n=a.carsModels[B(a.carsModels.length-1)],r=L();t.push({name:`${e} ${n}`,color:r})}const n=t.map((e=>f(e)));await Promise.allSettled(n)})(),await w();const t=v(),n=document.querySelector("#app");if(!(n instanceof HTMLElement))throw new Error("Can't find main section");n.innerHTML="",n.append(t),console.log("log",a.countCars)})(n);break;case i.BtnStartRace:(async n=>{n.preventDefault(),a.editorCar.btnStartRace?.setAttribute("disabled","disabled"),a.cars.forEach((e=>{y(e.id)})),await(async()=>{try{const r=a.cars.map((e=>H(e.id))),o=await Promise.all(r);let i=0;a.cars.forEach((e=>{a.carsRace[e.id]=!0,a.carsRaceTime[e.id]=o[i].distance/o[i].velocity,h(a.carsHTML[e.id],a.carsRaceTime[e.id]),i+=1})),a.editorCar.btnResetRace?.removeAttribute("disabled");const s=a.cars.map((e=>(async e=>{const n=await R(e,t.Drive);return n.success?e:n})(e.id))),d=await Promise.any(s),l=await g(d),u=(n=a.carsRaceTime[d],parseInt(n.toString(),10)/1e3);if(-1===l.id){const e={wins:1,time:u,id:d};await(async e=>{const t=await c.post(p,e);let n={id:-1,wins:0,time:0};return"object"==typeof t&&(n=Object(t)),n})(e)}else l.wins+=1,l.time>u&&(l.time=u),await(async t=>{const n=`${p}/${t.id}`,r={method:e.Put},{wins:a,time:o,id:i}=t,s={id:i,wins:a,time:o};let d={time:0,wins:0,id:0};if(await g(t.id)){const e=await c.put(n,s,r);"object"==typeof e&&(d=Object(e))}return d})(l);return await b(),s}catch(e){return e instanceof Error?"nobody wins":Promise.reject(new Error("Cant resolve promise"))}var n})(),console.log("StartRace click")})(n);break;case i.BtnResetRace:(async e=>{e.preventDefault();const{target:t}=e;if(!(t instanceof HTMLButtonElement))throw new Error("Can't find button element Reset");a.cars.forEach((async e=>{e.id&&(await I(e.id),a.carsRace[e.id]=!1,setTimeout((()=>{a.carsHTML[e.id].style.transform="translate(0)"}),50),E(e.id))})),a.editorCar.btnResetRace?.setAttribute("disabled","disabled"),a.editorCar.btnStartRace?.removeAttribute("disabled")})(n);break;case i.BtnCreateCar:(async e=>{e.preventDefault();const t=a.editorCar.formInputCreate?.value,n=a.editorCar.inputColorCreate?.value;t&&n&&await f({name:t,color:n}),await w();const r=v(),o=document.querySelector("#app");if(!(o instanceof HTMLElement))throw new Error("Can't find main section");o.innerHTML="",o.append(r)})(n);break;case i.BtnUpdateEdit:(async t=>{t.preventDefault();const n=a.editorCar.carEditId,r=a.editorCar.formInputEdit?.value,o=a.editorCar.inputColorEdit?.value;r&&o&&await(async t=>{const n=`${l}/${t.id}`,r={method:e.Put},{name:a,color:o,id:i}=t,s={name:a,color:o,id:i};let d={id:-1,name:"unknown",color:"unknown"};if(await m(t.id)){const e=await c.put(n,s,r);"object"==typeof e&&(d=Object(e))}return d})({id:n,name:r,color:o}),await w();const i=v(),s=document.querySelector("#app");if(!(s instanceof HTMLElement))throw new Error("Can't find main section");s.innerHTML="",s.append(i)})(n);break;case i.BtnGarageNextPage:console.log("next"),(async e=>{if(e.preventDefault(),console.log("next"),a.currentGaragePage<a.pagesCountGarage){a.currentGaragePage+=1,await w();const e=v(),t=document.querySelector("#app");if(!(t instanceof HTMLElement))throw new Error("Can't find main section");t.innerHTML="",t.append(e)}})(n);break;case i.BtnGaragePrevPage:(async e=>{if(e.preventDefault(),console.log("prev"),a.currentGaragePage>1){a.currentGaragePage-=1,await w();const e=v(),t=document.querySelector("#app");if(!(t instanceof HTMLElement))throw new Error("Can't find main section");t.innerHTML="",t.append(e)}})(n);break;case i.BtnWinnerNextPage:(async e=>{if(e.preventDefault(),console.log("next"),a.currentWinnersPage<a.pagesCountWinner){a.currentWinnersPage+=1,await b();const e=P(),t=document.querySelector("#app");if(!(t instanceof HTMLElement))throw new Error("Can't find main section");t.innerHTML="",t.append(e)}})(n);break;case i.BtnWinnerPrevPage:(async e=>{if(e.preventDefault(),a.currentWinnersPage>1){a.currentWinnersPage-=1,await b();const e=P(),t=document.querySelector("#app");if(!(t instanceof HTMLElement))throw new Error("Can't find main section");t.innerHTML="",t.append(e)}})(n)}}};document.addEventListener("DOMContentLoaded",(async()=>{await w(),console.log(a);const e=v();document.body.append((()=>{const e=o('<header class="header"> <div class="container"> <div class="logo"> <svg version="1.0" xmlns="http://www.w3.org/2000/svg" width="48.000000pt" height="48.000000pt" viewBox="0 0 512.000000 512.000000" preserveAspectRatio="xMidYMid meet"> <g transform="translate(0.000000,512.000000) scale(0.100000,-0.100000)"> <path d="M2366 4270 c-92 -15 -239 -56 -329 -94 -189 -78 -351 -190 -503 -348\n-346 -360 -452 -783 -339 -1345 69 -340 239 -691 480 -990 193 -241 489 -485\n725 -601 84 -42 103 -47 160 -47 53 1 79 7 140 36 246 116 540 359 753 624\n235 292 404 640 471 977 113 560 8 984 -334 1342 -203 212 -429 346 -708 418\n-103 26 -137 30 -287 33 -93 2 -196 0 -229 -5z m-721 -1151 c265 -33 458 -136\n571 -306 74 -112 130 -304 135 -468 6 -188 2 -195 -139 -195 -184 0 -374 47\n-501 124 -210 128 -331 383 -331 701 0 116 5 131 50 148 25 9 121 7 215 -4z\nm2076 -18 c16 -20 19 -40 19 -131 0 -312 -122 -569 -331 -696 -127 -77 -317\n-124 -501 -124 -115 0 -131 10 -142 82 -10 66 12 259 40 358 77 266 249 434\n509 500 109 27 204 39 303 37 75 -2 86 -5 103 -26z m-1401 -1396 c172 -86 314\n-86 486 1 66 34 73 35 100 23 36 -18 52 -59 36 -94 -14 -31 -167 -107 -250\n-124 -84 -17 -208 -14 -290 9 -101 28 -210 84 -224 116 -15 33 0 75 32 91 34\n17 31 18 110 -22z"/> <path class="alien" d="M1523 2898 c8 -102 46 -240 88 -319 86 -161 272 -263 519 -285 l83\n-7 -6 90 c-7 101 -45 243 -85 318 -37 68 -134 164 -207 202 -83 44 -192 72\n-304 80 l-94 6 6 -85z"/> <path class="alien" d="M3421 2969 c-76 -13 -184 -52 -248 -91 -150 -90 -244 -271 -260 -503\nl-6 -85 34 0 c64 0 219 30 286 55 223 84 345 268 369 556 l7 79 -64 -1 c-35\n-1 -88 -5 -118 -10z"/> </g> </svg> <a class="header_link" href="/"> <h1 class="main_title">x-com race</h1> </a> </div> <menu class="menu"> <button class="btn" id="btnToWinners">To Winners</button> <button class="btn" id="btnToGarage">To Garage</button> </menu> </div> </header> '),t=e.querySelector("#btnToWinners"),n=e.querySelector("#btnToGarage");return t?.addEventListener("click",S),n?.addEventListener("click",T),e})()),document.body.append((e=>{const t=o('<main id="app" class="main"></main> ');return t.addEventListener("click",x),e&&e.length>0&&t.append(...e),t})([e])),document.body.append(o('<footer class="footer">This is footer</footer> '))}))})();